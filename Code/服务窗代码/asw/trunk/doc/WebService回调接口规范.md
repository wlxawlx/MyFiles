[TOC]

<!--TOC-->

# WebService回调接口规范

## 适用范围

本规范功能建设于第三方平台医院接入系统上，为医院端WebService服务回调使用。方便如：排队通知，扣费通知，缴费通知等推送功能的实现。

## 规范说明

- 通讯协议：使用HTTP的POST协议。
- 服务地址：http://ip:port/callbackservice
- 报文格式：XML
- 编码格式：默认使用UTF-8
- 返回消息：XML格式的回复报文内容

### 公共请求参数

驱使请求参数包含如下内容：

| 参数项     | 参数名  | 类型     | 必选   | 描述        |
| ------- | ---- | ------ | ---- | --------- |
| pcode   | 协议代码 | string | 是    | 报文协议操作码   |
| content | 报文内容 | json   | 是    | 各协议具体报文内容 |

``` javascript
pcode="PD0201"&content="报文XML结构内容"
```

- XML结构的根TAG为“root”

#### 协议码格式解析

如有协议代码：PD0201，解析格式如下：

- PD：排队通知功能。
- 02：排队通知功能下的预约排队通知。
- 01：这个协议的第一个版本实现，或是第一种实现方式。

#### 回复代码列表

| 值   | 描述   |
| ---- | ------|
| 00   | 成功   |
| 01   | 请求参数错误 |
| 99   | 失败   |

## 协议内容

### 排队消息通知

排队消息通知，建议只向**最近十个号**的用户进行消息推送。

#### 门诊排队(PD0101)

以各个参数项信息进行推送，由前端来组织展示结构。

**请求报文内容**

| 参数项  | 参数名    | 类型    | 必选   | 描述                    |
| ------ | -------- | ------- | ----- | --------------------- |
| openid | 用户标识   | string | 是    | 支付宝用户ID             |
| pdlsh  | 排队序号   | string | 是    | 每一条排队记录的标识      |
| pdhm   | 排队号码   | string | 是    | 报道时获得的排队号码       |
| pdrq   | 排队时间   | string | 是    | 报道时的时间              |
| bcmc   | 班次名称   | string | 是    | 上午或是下午              |
| ksmc   | 科室名称   | string | 是    | 哪个科室就诊              |
| ysxm   | 医生姓名   | string | 是    | 就诊的医生                 |
| zsmc   | 诊室名称   | string | 是    | 就诊诊室的名称，如：方便门诊，228诊室等 |
| zswz   | 诊室位置   | string | 是    | 就诊诊室的位置，指哪个大楼         |
| fjhm   | 房间号码   | string | 是    | 就诊诊室的房间号码             |
| dqhm   | 当前就诊号码 | string | 是   | 当前医生在看哪个号码            |
| pdzt   | 排队状态   | string | 是    | 0:排队中；1：已结束；2：已过号     | 

``` xml
<root>
  <openid></openid>
  <pdlsh></pdlsh>
  <pdhm></pdhm>
  <pdrq></pdrq>
  <bcmc></bcmc>
  <ksmc></ksmc>
  <ysxm></ysxm>
  <zsmc></zsmc>
  <zswz></zswz>
  <fjhm></fjhm>
  <pdzt></pdzt>
</root>
```

完整的POST数据内容：

``` url
pcode="PD0101"&content="<root><openid></openid><pdlsh></pdlsh> <pdhm></pdhm> <pdrq></pdrq> <bcmc></bcmc> <ksmc></ksmc> <ysxm></ysxm> <zsmc></zsmc> <zswz></zswz><fjhm></fjhm><pdzt></pdzt></root>"
```

**返回报文内容**

| 参数项 | 参数名 | 类型   | 必选   | 描述          |
| ----- | ----- | ------ | ---- | ----------- |
| state |  状态  | string | 是   | 1：成功；0：失败 |

#### 检查排队(PD0201)

以各个参数项信息进行推送，由前端来组织展示结构。

**请求报文内容**

| 参数项  | 参数名    | 类型    | 必选   | 描述                    |
| ------ | -------- | ------- | ----- | --------------------- |
| openid | 用户标识   | string | 是    | 支付宝用户ID             |
| pdlsh  | 排队序号   | string | 是    | 每一条排队记录的标识      |
| pdhm   | 排队号码   | string | 是    | 报道时获得的排队号码       |
| pdrq   | 排队时间   | string | 是    | 报道时的时间              |
| bcmc   | 班次名称   | string | 是    | 上午或是下午              |
|    |    | string |     |               |
|    |    | string |     |               |
|    |    | string |     |               |
|    |    | string |     |               |
| fjhm   | 房间号码   | string | 是    | 就诊诊室的房间号码             |
| dqhm   | 当前就诊号码 | string | 是   | 当前医生在看哪个号码            |
| pdzt   | 排队状态   | string | 是    | 0:排队中；1：已结束；2：已过号     | 

**返回报文内容**

| 参数项 | 参数名 | 类型   | 必选   | 描述          |
| ----- | ----- | ------ | ---- | ----------- |
| state |  状态  | string | 是   | 1：成功；0：失败 |

#### 检查排队消息版(PD0301)

以各个消息方式进行推送，前端直接展示。

**请求报文内容**

| 参数项  | 参数名    | 类型    | 必选   | 描述                    |
| ------ | -------- | ------- | ----- | --------------------- |
| openid | 用户标识   | string | 是    | 支付宝用户ID             |
| message| 排队信息   | string | 是    | 已经组织好的排队信息      |


``` xml
<root>
  <openid></openid>
  <message></message>
</root>
```

完整的POST数据内容：

``` url
pcode="PD0101"&content="<root><openid></openid> <message></message> </root>"
```

**返回报文内容**

| 参数项 | 参数名 | 类型   | 必选   | 描述          |
| ----- | ----- | ------ | ---- | ----------- |
| state |  状态  | string | 是   | 1：成功；0：失败 |

### 缴费通知

医院端产生费用，要求用户进行付款或是自动扣款的情况。

#### 门诊缴费

| 参数项  | 参数名    | 类型    | 必选   | 描述                    |
| ------ | -------- | ------- | ----- | --------------------- |
| openid | 用户标识  | string | 是    | 支付宝用户ID             |
| fee    | 金额     | string | 是    | 单位元                   |
| name   | 费用名称  | string | 是    | 费用名称                 |
| type   | 费用类型   | string | 否    |                        |
|    |    | string |     |               |
|    |    | string |     |               |
|    |    | string |     |               |
|    |    | string |     |               |
| kddx   | 开单对象   | string | 是    | 是谁开的费用单，或是因为什么开的单 |

**返回报文内容**

| 参数项 | 参数名 | 类型   | 必选   | 描述          |
| ----- | ----- | ------ | ---- | ----------- |
| state |  状态  | string | 是   | 1：成功；0：失败 |
